<!DOCTYPE html>
<html>
<head>
    <title>USB Bridge</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .drive { margin-bottom: 10px; }
        .file { margin-left: 20px; }
        input[type="file"] { margin-top: 5px; }
    </style>
</head>
<body>
    <h1>USB Bridge</h1>
    <div id="drives"></div>

    <script>
        const API_BASE = " https://0236d86a5064.ngrok-free.app"; // replace with your Pi IP

        async function loadDrives() {
            const res = await fetch(`${API_BASE}/drives`);
            const data = await res.json();
            const container = document.getElementById("drives");
            container.innerHTML = "";
            data.drives.forEach(drive => {
                const div = document.createElement("div");
                div.className = "drive";
                div.innerHTML = `<strong>${drive}</strong> <button onclick="listFiles('${drive}')">Open</button>`;
                container.appendChild(div);
            });
        }

        async function listFiles(drive) {
            const res = await fetch(`${API_BASE}/files/${drive}`);
            const data = await res.json();
            const container = document.getElementById("drives");
            container.innerHTML = `<h2>${drive}</h2>`;

            // File list
            data.files.forEach(file => {
                const div = document.createElement("div");
                div.className = "file";
                div.innerHTML = `${file} <a href="${API_BASE}/download/${drive}/${file}" target="_blank">Download</a>`;
                container.appendChild(div);
            });

            // Upload form
            const uploadForm = document.createElement("form");
            uploadForm.innerHTML = `
                <input type="file" id="fileInput">
                <button type="button" onclick="uploadFile('${drive}')">Upload</button>
            `;
            container.appendChild(uploadForm);
        }

        async function uploadFile(drive) {
            const fileInput = document.getElementById("fileInput");
            if (fileInput.files.length === 0) return alert("Select a file first");
            const formData = new FormData();
            formData.append("file", fileInput.files[0]);
            const res = await fetch(`${API_BASE}/upload/${drive}`, { method: "POST", body: formData });
            const data = await res.json();
            alert(`Uploaded: ${data.filename}`);
            listFiles(drive);
        }

        loadDrives();
    </script>
</body>
</html>
